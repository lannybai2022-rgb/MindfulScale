# 新功能说明

## ✅ 已实现功能

### 1. 注意力地图 - 本周数据展示
- **修改位置**: `components/AttentionMap.tsx`
- **功能**: 注意力地图现在只显示当前周（周一到周日）的数据
- **实现方式**: 添加了 `isInCurrentWeek` 函数来过滤数据
- **显示**: 如果本周没有数据，会显示"本周暂无数据"的提示

### 2. 内测账号登录系统

#### 2.1 登录功能
- **组件**: `components/Login.tsx`
- **功能**: 
  - 用户名/密码登录
  - 账号有效期验证（30天）
  - 错误提示

#### 2.2 账号管理服务
- **文件**: `services/accountService.ts`
- **功能**:
  - `login()`: 登录验证
  - `checkCanSubmit()`: 检查是否可以提交（每日限制和有效期）
  - `recordUsage()`: 记录使用次数
  - `getAccountInfo()`: 获取账号信息和使用统计
  - `generateTestAccounts()`: 生成10个测试账号

#### 2.3 使用限制
- **每日限制**: 15次
- **有效期**: 30天
- **检查时机**: 每次提交前自动检查
- **显示**: 在 header 中显示剩余次数

#### 2.4 测试账号
- **数量**: 10个
- **格式**: 
  - 用户名: `test01` - `test10`
  - 密码: `pass01` - `pass10`
- **生成方式**: 见 `database_setup.md`

### 3. 数据库表结构

需要创建3个表：
1. **emotion_logs**: 情绪日志（已存在）
2. **test_accounts**: 测试账号
3. **account_usage**: 账号使用记录

详细 SQL 见 `database_setup.md`

## 使用流程

1. **设置数据库**
   - 在 Supabase 中创建表结构（见 `database_setup.md`）
   - 在设置中配置 Supabase URL 和 Key

2. **生成测试账号**
   - 使用 SQL 脚本或 `generateTestAccounts()` 函数生成10个测试账号

3. **登录**
   - 使用测试账号登录（test01/pass01 等）

4. **使用**
   - 登录后可以看到剩余使用次数
   - 每次提交前会自动检查限制
   - 达到每日限制或账号过期时会提示

5. **管理账号**
   - 可以通过 Supabase Dashboard 修改账号限制
   - 可以延长有效期
   - 可以重置使用次数

## 界面变化

1. **登录界面**: 未登录时显示登录页面
2. **Header**: 
   - 显示当前用户名
   - 显示今日剩余次数（颜色编码：绿色>5次，橙色1-5次，红色0次）
   - 退出登录按钮
3. **注意力地图**: 标题更新为"本周时空坐标系中的念头分布"

## 数据存储

- **账号信息**: 存储在 `test_accounts` 表
- **使用记录**: 存储在 `account_usage` 表（按日期统计）
- **情绪日志**: 存储在 `emotion_logs` 表（关联 `user_id`）

## 注意事项

1. 必须配置 Supabase 才能使用登录功能
2. 账号信息存储在数据库中，可以通过 SQL 修改
3. 使用次数按日期（YYYY-MM-DD）统计
4. 账号过期后需要重新登录，过期账号无法使用

